# API Documentation for Gradle Class Finder MCP

This document describes the JSON API provided by the `server.py` component of the Gradle Class Finder MCP tool. This API allows clients to request source code for specific classes within Gradle project dependencies.

## Endpoint (Conceptual)

While `server.py` can be adapted to various interfaces (e.g., HTTP server, direct function call), this documentation describes the logical input and output structure. For a CLI usage, these would map to command-line arguments and standard output.

## Request Format

Clients send a JSON object with the following parameters:

```json
{
  "project_path": "/path/to/your/gradle/project",
  "class_name": "com.example.MyClass",
  "submodule_path": "my-submodule" // Optional: Path to a specific Gradle submodule relative to project_path
}
```

### Parameters:

*   `project_path` (string, **required**):
    The absolute path to the root directory of the Gradle project. This is where the `settings.gradle` or `build.gradle` for the root project is located.

*   `class_name` (string, **required**):
    The fully qualified name of the class to search for (e.g., `com.google.common.collect.ImmutableList`).

*   `submodule_path` (string, **optional**):
    The path to a specific Gradle submodule within the `project_path`. This path should be relative to the `project_path`. If omitted, the search will be performed across the entire root project's dependencies.

## Response Format

The tool responds with a JSON object indicating the status of the request and the found matches (if any).

### Success Response:

```json
{
  "status": "success",
  "matches": [
    {
      "source_type": "source" | "decompiled", // Indicates if the source is original or decompiled
      "source_code": "public class ImmutableList { ... }", // The actual source code content
      "jar_path": "/path/to/guava-31.1-jre.jar", // Absolute path to the JAR file containing the class
      "source_jar_path": "/path/to/guava-31.1-jre-sources.jar" | null, // Absolute path to the source JAR if found, otherwise null
      "dependency_coordinates": "com.google.guava:guava:31.1-jre", // Maven/Gradle coordinates of the dependency
      "class_name": "com.google.common.collect.ImmutableList" // The fully qualified name of the class
    },
    // ... more match objects if the class is found in multiple dependencies/versions
  ]
}
```

#### `matches` Array:

An array of objects, where each object represents a unique occurrence of the requested class found within the project's dependencies. Each match object contains:

*   `source_type` (string):
    *   `"source"`: The `source_code` is from an original source JAR.
    *   `"decompiled"`: The `source_code` was generated by decompiling a `.class` file.
*   `source_code` (string):
    The content of the Java source file (either original or decompiled).
*   `jar_path` (string):
    The absolute file system path to the binary JAR file that contains the `.class` file for the requested class.
*   `source_jar_path` (string | null):
    The absolute file system path to the source JAR file (`-sources.jar`) if it was found and used to retrieve the source. `null` if no source JAR was found or used.
*   `dependency_coordinates` (string):
    The Maven/Gradle coordinates of the dependency that contains this class (e.g., `group:artifact:version`). This helps distinguish between different versions or libraries containing the same class name.
*   `class_name` (string):
    The fully qualified name of the class that was searched for.

### Error Response:

```json
{
  "status": "error",
  "message": "A human-readable error message.",
  "details": "Optional: More technical details or stack trace for debugging."
}
```

#### Error Parameters:

*   `status` (string):
    Always `"error"` for error responses.
*   `message` (string):
    A concise, human-readable description of the error.
*   `details` (string, optional):
    Additional technical information, such as a stack trace or specific error codes, useful for debugging. This might be omitted in production environments for security reasons.

## Example Usage (Conceptual)

```python
import json

# Assuming server.py exposes a function like `find_class_source`
def find_class_source(project_path, class_name, submodule_path=None):
    # This would internally call the helper.jar and decompiler
    # For demonstration, let's assume it returns a mock response
    if class_name == "com.example.MyClass":
        return {
            "status": "success",
            "matches": [
                {
                    "source_type": "source",
                    "source_code": "package com.example;\n\npublic class MyClass {\n    // Original source\n}",
                    "jar_path": "/path/to/my-lib-1.0.jar",
                    "source_jar_path": "/path/to/my-lib-1.0-sources.jar",
                    "dependency_coordinates": "com.example:my-lib:1.0",
                    "class_name": "com.example.MyClass"
                }
            ]
        }
    else:
        return {
            "status": "error",
            "message": "Class not found."
        }

# Example call
request_data = {
    "project_path": "/Users/erio/codes/my-gradle-project",
    "class_name": "com.example.MyClass",
    "submodule_path": "app"
}

response = find_class_source(**request_data)
print(json.dumps(response, indent=2))
```